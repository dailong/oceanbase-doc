# 体验 OceanBase 数据库企业版

OceanBase 数据库支持部署在 x86_64 以及 ARM_64 架构的物理服务器和主流的虚拟机。 OceanBase 数据库支持单副本部署，并且单副本 OceanBase 集群还可以扩容（增加节点），所以也称为集群。本节主要介绍在普通的物理服务器上通过使用 RPM 包安装单副本 OceanBase 集群。

有关 OceanBase 集群部署的详细信息，请参见 [部署简介](../../4.deploy/1.deploy-overview.md)。

## 前提条件

在参考本文安装 OceanBase 数据库之前，确保您的软硬件环境满足以下要求：

1. 服务器架构及 Linux 操作系统版本要求。

   支持在下表所示的 Linux 操作系统中安装 OceanBase 数据库。

   |       Linux操作系统       |    版本   |             服务器架构         |
   |--------------------------|-----------|-------------------------------|
   | AliOS                    | 7.2 及以上   | x86_64（包括海光），ARM_64（鲲鹏、飞腾） |
   | 龙蜥 AnolisOS            | 8.6 及以上   | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
   | KylinOS                  | V10         | x86_64（包括海光），ARM_64（鲲鹏、飞腾） |
   | 统信 UOS                 | V20         | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
   | 中科方德 NFSChina         | 4.0 及以上  | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
   | 浪潮 Inspur kos           | 5.8        | x86_64（包括海光），ARM_64（鲲鹏、飞腾）|
   | CentOS / Red Hat Enterprise Linux | 7.2 及以上 <blockquote><b>说明</b></br>暂不支持 CentOS 8.X。</blockquote>  | x86_64（包括海光），ARM_64（鲲鹏、飞腾） |

2. 服务器配置。

   服务器配置至少是 CPU 4 Core，内存 16 GB。

3. 磁盘规划。

   默认情况下，使用 `/data/1` 作为数据目录，`/data/log1` 作为日志目录，`/home` 作为 OceanBase 数据库的安装目录。

## 使用 OBD 部署 OceanBase 数据库

  <main id="notice" type='explain'>
    <h4>说明</h4>
    <p> 以下内容以 x86 架构的 CentOS Linux 7.9 镜像作为环境，其他环境可能略有不同。 </p>
  </main>

### 步骤 1：下载并安装 all-in-one package

从 V4.0.0 开始，OceanBase 提供统一的安装包 all-in-one package。您可以通过这个统一的安装包一次性完成 OBD、OceanBase 数据库、 ODP、OBAgent、Grafana、OCP Express 和 Prometheus 的安装；您可以根据实际需求选择部分组件安装或者指定组件的版本。

#### 离线安装 all-in-one package

1. 请联系技术支持获取最新的企业版 all-in-one package 安装包。

2. 执行以下命令解压安装包并进入安装目录。

    ``` bash
    tar -xzf oceanbase-all-in-one-4.1.0.0-100120230317111320.el7.x86_64.tar
    cd oceanbase-all-in-one/bin/
    ```

3. 执行安装脚本

   ```bash
   [root@**** bin]#  ./install.sh
   name: grafana
   version: 7.5.17
   release:1
   arch: x86_64
   md5: 1bf1f338d3a3445d8599dc6902e7aeed4de4e0d6
   add /home/admin/oceanbase-all-in-one/rpms/grafana-7.5.17-1.el7.x86_64.rpm to local mirror
   name: obagent
   version: 1.3.0
   release:20.el7
   arch: x86_64
   md5: e96592c0306ed99a094cabb2a65343e4b636f1ea
   add /home/admin/oceanbase-all-in-one/rpms/obagent-1.3.0-20.el7.x86_64.rpm to local mirror
   name: obproxy
   version: 4.1.0.0
   release:32023021710.el7
   arch: x86_64
   md5: b27304d89a1d80711107b597582a8e2636c28fba
   add /home/admin/oceanbase-all-in-one/rpms/obproxy-4.1.0.0-32023021710.el7.x86_64.rpm to local mirror
   name: oceanbase
   version: 4.1.0.0
   release:100000982023031415.el7
   arch: x86_64
   md5: bb1509879417825ed9cdab2479eb79c1c037a44a
   add /home/admin/oceanbase-all-in-one/rpms/oceanbase-4.1.0.0-100000982023031415.el7.x86_64.rpm to local mirror
   name: ocp-express
   version: 1.0.0
   release:100000382023031616.el7
   arch: x86_64
   md5: 992e9837f41f016ecf43d6bcb7225f17e12bea09
   add /home/admin/oceanbase-all-in-one/rpms/ocp-express-1.0.0-100000382023031616.el7.x86_64.rpm to local mirror
   name: prometheus
   version: 2.37.1
   release:10000102022110211.el7
   arch: x86_64
   md5: 58913c7606f05feb01bc1c6410346e5fc31cf263
   add /home/admin/oceanbase-all-in-one/rpms/prometheus-2.37.1-10000102022110211.el7.x86_64.rpm to local mirror
   Trace ID: d5b277c8-c4a1-11ed-8099-e68dd98f006d
   If you want to view detailed obd logs, please run: obd display-trace d5b277c8-c4a1-11ed-8099-e68dd98f006d
   Disable remote ok
   Trace ID: d68a7eac-c4a1-11ed-9cb0-e68dd98f006d
   If you want to view detailed obd logs, please run: obd display-trace d68a7eac-c4a1-11ed-9cb0-e68dd98f006d

   add auto set env logic to profile: /root/.bash_profile
   ```

#### 安装后设置和验证

  安装脚本会尝试自动设置好环境变量，对于特定的系统如果环境变量未生效，可以根据提示，执行设置环境变量的脚本，如果需要设置为每次登陆都生效，需要根据用户使用的 terminal 环境，写到对应的 profile 文件中，一般为 `~/.bash_profile`。

  ```bash
    Install Finished
    =====================================================================
    Setup Environment:     source ~/.oceanbase-all-in-one/bin/env.sh
    Quick Start:           obd demo
    More Details:          obd -h
    =====================================================================
  ```

  <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>安装完成后需执行 <code>source ~/.oceanbase-all-in-one/bin/env.sh</code> 否则直接执行 <code>which obd</code> 会失败。</p>
  </main>

  执行 `which obd` 和 `which obclient` 检测是否安装成功，如果可以找到 oceanbase-all-in-one 下的 obd 和 obclient 路径，则表示安装成功。

  ```bash
    [root@test .obd]# which obd
    /root/.oceanbase-all-in-one/obd/usr/bin/obd
    [root@test .obd]# which obclient
    /root/.oceanbase-all-in-one/obclient/u01/obclient/bin/obclient
  ```

### 步骤 2：使用 obd demo 快速部署单机体验环境

使用该命令可在不传入配置文件的情况下直接在本机部署并启动指定的组件。固定部署名为 `demo`。部署完成后，可以通过命令 `obd cluster list` 查看该集群，也可以通过其他的集群命令进行管理，比如 `obd cluster display demo` 等。

执行 `obd demo` 前您需要确认以下信息：

+ `2881` 和 `2882` 端口没有被占用。

+ 机器可用内存不低于 `6 G`。

+ 机器 CPU 数目不低于 `2`。

+ 机器可用磁盘空间不小于 `54 G`。

+ 打开的文件句柄数量不小于 `20000`。
  
`obd demo` 部署方式采用最小规格部署，部署的组件版本默认为最新版本，默认部署的组件包含 OceanBase、ODP、OBAgent、Grafana、Prometheus。

  <main id="notice" type='notice'>
    <h4>注意</h4>
    <p><code>obd demo</code> 部署仅适用于快速上手体验，不适用于生产环境。</p>
  </main>

#### 部署并启动 OceanBase 数据库

```shell
[root@****]# obd demo -c oceanbase,obproxy
Package oceanbase-4.1.0.0-100000982023031415.el7 is available.
Package obproxy-4.1.0.0-32023021710.el7 is available.
install oceanbase-4.1.0.0 for local ok
install obproxy-4.1.0.0 for local ok
Cluster param config check ok
Open ssh connection ok
Generate observer configuration ok
Generate obproxy configuration ok
+------------------------------------------------------------------------------------------+
|                                         Packages                                         |
+------------+---------+------------------------+------------------------------------------+
| Repository | Version | Release                | Md5                                      |
+------------+---------+------------------------+------------------------------------------+
| oceanbase  | 4.1.0.0 | 100000982023031415.el7 | bb1509879417825ed9cdab2479eb79c1c037a44a |
| obproxy    | 4.1.0.0 | 32023021710.el7        | b27304d89a1d80711107b597582a8e2636c28fba |
+------------+---------+------------------------+------------------------------------------+
Repository integrity check ok
Parameter check ok
Open ssh connection ok
Cluster status check ok
Initializes observer work home ok
Initializes obproxy work home ok
Remote oceanbase-4.1.0.0-100000982023031415.el7-bb1509879417825ed9cdab2479eb79c1c037a44a repository install ok
Remote oceanbase-4.1.0.0-100000982023031415.el7-bb1509879417825ed9cdab2479eb79c1c037a44a repository lib check ok
Remote obproxy-4.1.0.0-32023021710.el7-b27304d89a1d80711107b597582a8e2636c28fba repository install ok
Remote obproxy-4.1.0.0-32023021710.el7-b27304d89a1d80711107b597582a8e2636c28fba repository lib check ok
demo deployed
Get local repositories ok
Search plugins ok
Open ssh connection ok
Load cluster param plugin ok
Check before start observer ok
[WARN] OBD-1012: (127.0.0.1) clog and data use the same disk (/)

Check before start obproxy ok
Start observer ok
observer program health check ok
Connect to observer ok
Initialize oceanbase ok
Start obproxy ok
obproxy program health check ok
Connect to obproxy ok
Initialize obproxy ok
Wait for observer init ok
+---------------------------------------------+
|                   observer                  |
+-----------+---------+------+-------+--------+
| ip        | version | port | zone  | status |
+-----------+---------+------+-------+--------+
| 127.0.0.1 | 4.1.0.0 | 2881 | zone1 | ACTIVE |
+-----------+---------+------+-------+--------+
obclient -h127.0.0.1 -P2881 -uroot -Doceanbase -A

+---------------------------------------------+
|                   obproxy                   |
+-----------+------+-----------------+--------+
| ip        | port | prometheus_port | status |
+-----------+------+-----------------+--------+
| 127.0.0.1 | 2883 | 2884            | active |
+-----------+------+-----------------+--------+
obclient -h127.0.0.1 -P2883 -uroot -Doceanbase -A
demo running
Trace ID: 0d6cfd06-c4a6-11ed-ac45-e68dd98f006d
If you want to view detailed obd logs, please run: obd display-trace 0d6cfd06-c4a6-11ed-ac45-e68dd98f006d
```

当回显信息中出现 `demo running` 时，表示部署成功。

可以通过回显信息中的直连方式 `obclient -h127.0.0.1 -P2881 -uroot -Doceanbase -A` 或者通过 ODP 连接的方式 `obclient -h127.0.0.1 -P2883 -uroot -Doceanbase -A` 连接数据库。

##### 使用 OBClient 客户端连接到 OceanBase 数据库

通过直连方式连接 OceanBase 数据库，示例如下：

```shell
[root@****]# obclient -uroot@sys -h127.0.0.1 -P2881 -A
Welcome to the OceanBase.  Commands end with ; or \g.
Your OceanBase connection id is 3221487644
Server version: OceanBase 4.1.0.0 (r100000982023031415-5a1bf675f0c2756e67fd0fc5546d2f9d191c0f24) (Built Mar 14 2023 15:17:07)

Copyright (c) 2000, 2018, OceanBase and/or its affiliates. All rights reserved.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

obclient [(none)]> 
```

您也可以通过参数控制部署的组件、组件的版本、配置以及部署的目录。更多关于 `obd demo` 命令的介绍，参见 [快速部署命令](https://www.oceanbase.com/docs/community-obd-cn-10000000000900365)。

当安装 grafana 或 prometheus 时，会输出 grafana 或 prometheus 的访问地址，类似以下输出。在阿里云或其他云环境下，因为安装程序可能无法获取公网 IP，可能输出的是内网地址（在本例中，为 `192.168.1.1`），此 IP 非公网地址，您需要使用正确的地址。

```test
-prometheus program health check ok
-Connect to Prometheus ok
-Initialize cluster ok
+------------------------------------------------------+
|                      prometheus                      |
+---------------------------+------+----------+--------+
| url                       | user | password | status |
+---------------------------+------+----------+--------+
| http://192.168.1.1:9090   |      |          | active |
+---------------------------+------+----------+--------+
+------------------------------------------------------------------+
|                             grafana                              |
+-------------------------------------+-------+-----------+--------+
| url                                 | user  | password  | status |
+-------------------------------------+-------+-----------+--------+
| http://192.168.1.1:3000/d/oceanbase | admin | ****** | active |
+-------------------------------------+-------+-----------+--------+
 ```

### 创建普通租户

OceanBase 集群部署完成后，数据库中默认创建 `sys` 租户。此后可以根据业务需要使用 `sys` 租户新建普通租户。

创建普通租户的详细信息，请参见 [创建租户](../../4.deploy/3.deploy-oceanbase-database-enterprise/4.command-line-deployment/5.create-oceanbase-tenant-command-line/2.create-tenant.md)。

### 连接 OceanBase 数据库

连接 OceanBase 数据库的方式，这里命令行推荐使用 OceanBase 数据库客户端（OBClient） 即 OceanBase 数据库专用的命令行客户端工具，白屏推荐 OceanBase 开发者中心（OceanBase Developer Center，ODC）。

+ 使用 OBClient 连接 OceanBase 数据库，请参见 [通过 OBClient 连接 OceanBase 租户](../../3.develop/1.application-development-of-mysql-mode/1.database-connection-with-client-of-mysql-mode/3.connect-to-an-oceanbase-tenant-by-using-obclient-of-mysql-mode.md)。
  
+ 使用 ODC 连接数据库，请参见 [通过 ODC 连接 OceanBase 租户](../../3.develop/1.application-development-of-mysql-mode/1.database-connection-with-client-of-mysql-mode/4.connect-to-the-oceanbase-database-through-odc-of-mysql-mode.md)。

连接 OceanBase 数据库更多详情，请参见 [连接方式概述](../../3.develop/1.application-development-of-mysql-mode/1.database-connection-with-client-of-mysql-mode/1.connection-methods-overview-of-mysql-mode.md)。
